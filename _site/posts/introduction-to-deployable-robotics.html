

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>An introduction to deployable robotics - Navaneeth Suresh</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Navaneeth Suresh">
<meta property="og:title" content="An introduction to deployable robotics">


  <link rel="canonical" href="http://localhost:4000/posts/introduction-to-deployable-robotics">
  <meta property="og:url" content="http://localhost:4000/posts/introduction-to-deployable-robotics">



  <meta property="og:description" content="Apps developed using the Robotic Operating System can be made repeatable and reproducible. Why don’t we make them deployable? Docker is a tool designed to make it easier to create, deploy, and run applications by using containers. Let’s ship our ROS app using Docker containers.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2018-04-11T00:00:00-07:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Navaneeth Suresh",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Navaneeth Suresh Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <!--Remove title><li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Navaneeth Suresh</a></li>-->
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/">about</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">blog</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/me.jpg" class="author__avatar" alt="Navaneeth Suresh">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Navaneeth Suresh</h3>
    <p class="author__bio"></p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Kharagpur, India</li>
      
      
      
      
        <li><a href="mailto:navaneeths1998@gmail.com"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
      
      
       
      
        <li><a href="https://twitter.com/_themousepotato"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="https://www.linkedin.com/in/navaneethsuresh"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="https://github.com/themousepotato"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
      
      
        <li><a href="https://goodreads.com/themousepotato"><i class="fab fa-fw fa-goodreads-g" aria-hidden="true"></i> Goodreads</a></li>
      
      
      
      
      
      
      
        <li><a href="https://steamcommunity.com/id/_nns"><i class="fab fa-fw fa-steam-square" aria-hidden="true"></i> Steam</a></li>
      
      
        <li><a href="https://letterboxd.com/navaneethsuresh"><i class="fa fa-video" aria-hidden="true"></i> &nbsp;Letterboxd</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="An introduction to deployable robotics">
    <meta itemprop="description" content="Apps developed using the Robotic Operating System can be made repeatable and reproducible. Why don’t we make them deployable? Docker is a tool designed to make it easier to create, deploy, and run applications by using containers. Let’s ship our ROS app using Docker containers.">
    <meta itemprop="datePublished" content="April 11, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">An introduction to deployable robotics
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  8 minute read
	
</p>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2018-04-11T00:00:00-07:00">April 11, 2018</time></p>
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
        <p>Apps developed using the Robotic Operating System can be made repeatable and reproducible. Why don’t we make them deployable? Docker is a tool designed to make it easier to create, deploy, and run applications by using containers. Let’s ship our ROS app using Docker containers.</p>

<h3 id="what-is-docker-">What is Docker ?</h3>
<p>Docker is a tool designed to make it easier to create, deploy, and run applications by using containers. Containers allow a developer to package up an application with all of the parts it needs, such as libraries and other dependencies, and ship it all out as one package. By doing so, thanks to the container, the developer can rest assured that the application will run on any other Linux machine regardless of any customized settings that machine might have that could differ from the machine used for writing and testing the code.</p>

<p>Unlike a virtual machine, rather than creating a whole virtual operating system, Docker allows applications to use the same Linux kernel as the system that they’re running on and only requires applications be shipped with things not already running on the host computer. This gives a significant performance boost and reduces the size of the application.</p>

<h3 id="why-deploy-ros-apps">Why deploy ROS apps?</h3>
<p>Apps developed using the Robotic Operating System can be made repeatable and reproducible. Why don’t we make them deployable? Let’s go through some hardware drivers which want to use ROS tools. They includes cameras, depth cameras, laser cameras, robots, audio, inertial units, GPS, joysticks. Sounds cool :stuck_out_tongue_winking_eye: !</p>

<p>There are variety of ROS ecosystems also. Have a look at them.</p>

<p><img src="https://raw.githubusercontent.com/TheMousePotato/ROSAppsDeployment/master/images/ecosyss.png" alt="ROS ecosystems" /></p>

<p>Let’s try to combine our areas of interest. First have a look at a normal software development environment matrix.</p>

<p><img src="https://github.com/TheMousePotato/ROSAppsDeployment/raw/master/images/matrix1.png" alt="Software development matrix" /></p>

<p>Now, see how the robotics development progress in a matrix:</p>

<p><img src="https://github.com/TheMousePotato/ROSAppsDeployment/raw/master/images/matrix2.png" alt="Robotics development matrix" /></p>

<p>Yuck! Too complex? Time has come to re-invent the convensional approach. The cool thing about docker is that a container has no need to account for the changes in another container. Let’s try to make it simpler to understand. I’m maintaining a container for running apps required for joystick(say). My friend does that for camera. Then, my friend don’t need to bother about dependencies for running my joystick apps. In the same way, I don’t have to keep track of his development. So, I only need to install the libraries for my peripheral and so as my friend. If we are not deploying it using containers, then we have to work on a single space with all the packages installed. The worst thing about this non-deployable robotics is we have to commit each and every update for the libraries unnecessarily. We need to look after the libraries which we have no point of interest. Through containers, things get more simplification. Now the interesting thing comes to action. Our peripherals can still communicate. How? Each container has got an IP address and Docker act as a pathway and provides several network topologies to connect our nodes. Wow! Let’s see it in action.</p>

<h3 id="how-to-use-docker-to-ship-ros-apps">How to use Docker to ship ROS apps?</h3>
<p>As we have learnt to make things easier so far, let’s try to implement it step by step. Links to installation and proxy setup for Docker are given in the end of this documentation. After that, let’s start.</p>

<h4 id="volumes">Volumes</h4>
<p>By default Docker uses <code class="language-plaintext highlighter-rouge">/root/.ros/</code> directory to keep track of the logs and debugging info. If you want to change it to your home directory(say ‘ubuntu’), perform :</p>

<blockquote>
  <p>$ docker run -v “/home/ubuntu/.ros/:/root/.ros/” ros</p>
</blockquote>

<h4 id="devices">Devices</h4>
<p>Some application may require device access for acquiring images from connected cameras, control input from human interface device, or GPUS for hardware acceleration. This can be done using the –device run argument to mount the device inside the container, providing processes inside hardware access.</p>

<h4 id="networks">Networks</h4>
<p>Although one process per container is recommended, Docker networks can also be extended to use several running ROS apps. See documentation on <a href="http://wiki.ros.org/ROS/NetworkSetup">NetworkSetup</a>.</p>

<h3 id="start-by-an-example">Start by an example</h3>
<p>For the communication between our ROS nodes, there should be a virtual network. In this short example, we’ll create a virtual network, spin up a new container running roscore advertised as the master service on the new network, then spawn a message publisher and subscriber process as services on the same network.</p>

<h4 id="build-image">Build image</h4>

<blockquote>
  <p>Build a ROS image that includes ROS tutorials using this <code class="language-plaintext highlighter-rouge">Dockerfile</code>:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM ros:indigo-ros-base
# install ros tutorials packages
RUN apt-get update &amp;&amp; apt-get install -y \
    ros-indigo-ros-tutorials \
    ros-indigo-common-tutorials \
    &amp;&amp; rm -rf /var/lib/apt/lists/
</code></pre></div></div>

<blockquote>
  <p>Then to build the image from within the same directory:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build --tag ros:ros-tutorials .
</code></pre></div></div>

<h4 id="create-network">Create network</h4>

<blockquote>
  <p>To create a new network foo, we use the network command:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create foo
</code></pre></div></div>

<blockquote>
  <p>Now that we have a network, we can create services. Services advertise there location on the network, making it easy to resolve the location/address of the service specific container. We’ll use this make sure our ROS nodes can find and connect to our ROS master.</p>
</blockquote>

<h4 id="run-services">Run services</h4>

<blockquote>
  <p>To create a container for the ROS master and advertise it’s service:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker run -it --rm \
    --net foo \
    --name master \
    ros:ros-tutorials \
    roscore
</code></pre></div></div>

<blockquote>
  <p>Now you can see that master is running and is ready manage our other ROS nodes. To add our talker node, we’ll need to point the relevant environment variable to the master service:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker run -it --rm \
    --net foo \
    --name talker \
    --env ROS_HOSTNAME=talker \
    --env ROS_MASTER_URI=http://master:11311 \
    ros:ros-tutorials \
    rosrun roscpp_tutorials talker
</code></pre></div></div>

<blockquote>
  <p>Then in another terminal, run the listener node similarly:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker run -it --rm \
    --net foo \
    --name listener \
    --env ROS_HOSTNAME=listener \
    --env ROS_MASTER_URI=http://master:11311 \
    ros:ros-tutorials \
    rosrun roscpp_tutorials listener
</code></pre></div></div>

<blockquote>
  <p>Alright! You should see listener is now echoing each message the talker broadcasting. You can then list the containers and see something like this:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker service ls
SERVICE ID          NAME                NETWORK             CONTAINER
67ce73355e67        listener            foo                 a62019123321
917ee622d295        master              foo                 f6ab9155fdbe
7f5a4748fb8d        talker              foo                 e0da2ee7570a
</code></pre></div></div>

<blockquote>
  <p>And for the services:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
a62019123321        ros:ros-tutorials   "/ros_entrypoint.sh    About a minute ago   Up About a minute   11311/tcp           listener
e0da2ee7570a        ros:ros-tutorials   "/ros_entrypoint.sh    About a minute ago   Up About a minute   11311/tcp           talker
f6ab9155fdbe        ros:ros-tutorials   "/ros_entrypoint.sh    About a minute ago   Up About a minute   11311/tcp           master
</code></pre></div></div>

<h4 id="introspection">Introspection</h4>

<blockquote>
  <p>Ok, now that we see the two nodes are communicating, let get inside one of the containers and do some introspection what exactly the topics are:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker exec -it master bash
  source /ros_entrypoint.sh
</code></pre></div></div>

<blockquote>
  <p>If we then use rostopic to list published message topics, we should see something like this:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rostopic list
/chatter
/rosout
/rosout_agg
</code></pre></div></div>

<h4 id="tear-down">Tear down</h4>

<blockquote>
  <p>To tear down the structure we’ve made, we just need to stop the containers and the services. We can stop and remove the containers using Ctrl^C where we launched the containers or using the stop command with the names we gave them:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker stop master talker listener
  docker rm master talker listener
</code></pre></div></div>

<h4 id="compose">Compose</h4>

<blockquote>
  <p>Now that you have an appreciation for bootstrapping a distributed ROS example manually, lets try and automate it using docker-compose.</p>
</blockquote>

<blockquote>
  <p>Start by making a folder named rostutorials and moving the Dockerfile we used earlier inside this directory. Then create a yaml file named docker-compose.yml in the same directory and paste the following inside:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '2'
services:
  master:
    build: .
    container_name: master
    command:
      - roscore
  
  talker:
    build: .
    container_name: talker
    environment:
      - "ROS_HOSTNAME=talker"
      - "ROS_MASTER_URI=http://master:11311"
    command: rosrun roscpp_tutorials talker
  
  listener:
    build: .
    container_name: listener
    environment:
      - "ROS_HOSTNAME=listener"
      - "ROS_MASTER_URI=http://master:11311"
    command: rosrun roscpp_tutorials listener
</code></pre></div></div>
<blockquote>
  <p>Now from inside the same folder, use docker-copose to launch our ROS nodes and specify that they coexist on their own network:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker-compose up -d
</code></pre></div></div>

<blockquote>
  <p>Notice that a new network named rostutorials_default has now been created, you can inspect it further with:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker network inspect rostutorials_default
</code></pre></div></div>

<blockquote>
  <p>We can monitor the logged output of each service, such as the listener node like so:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker-compose logs listener
</code></pre></div></div>

<blockquote>
  <p>Finally, we can stop and remove all the relevant containers using docker-copose from the same directory:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker-compose stop
  docker-compose rm
</code></pre></div></div>

<blockquote>
  <p>Note: the auto-generated network, rostutorials_default, will persist over the life of the docker engine or until you explicitly remove it using docker network rm.</p>
</blockquote>

<h3 id="conclusion">Conclusion</h3>
<p>Let’s have a look at a funny cartoon on convensional approach on robotics.</p>

<p><img src="https://github.com/TheMousePotato/ROSAppsDeployment/raw/master/images/cartoon2.jpg" alt="Cartoon making fun of convensional robotics" /></p>

<p>Now, see how it has changed.</p>

<p><img src="https://github.com/TheMousePotato/ROSAppsDeployment/raw/master/images/simplify.png" alt="Image of deployable robotics" /></p>

<h3 id="some-ros-apps-shipped-using-docker">Some ROS apps shipped using Docker</h3>
<ul>
  <li><a href="https://github.com/ruffsl/ros_caffe/tree/master/docker">Caffe</a></li>
  <li><a href="https://github.com/ruffsl/gazebo_docker_demos">Gazemo demos</a></li>
</ul>

<h3 id="reference-and-further-reading">Reference and further reading</h3>
<ul>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04">Docker for beginners - tutorial by DigitalOcean</a></li>
  <li><a href="https://github.com/wsargent/docker-cheat-sheet">Docker cheatsheet</a></li>
  <li><a href="https://stackoverflow.com/questions/23111631/cannot-download-docker-images-behind-a-proxy">Configuring network proxy for using Docker</a></li>
  <li><a href="https://registry.hub.docker.com/_/ros/">Official Docker library for ROS</a></li>
  <li><a href="https://docs.docker.com/samples/library/ros/">Official documentation from Docker on ROS</a></li>
  <li><a href="http://wiki.ros.org/docker">Official documentation from ROS on Docker</a></li>
  <li><a href="https://www.osrfoundation.org/">Official website of Open Robotics</a></li>
  <li><a href="https://rosorg.slack.com/messages/docker/">Docker on ROS slack channel</a></li>
  <li><a href="http://answers.ros.org/questions/scope:all/sort:activity-desc/tags:Docker/page:1/">FAQ on Docker at ROS website</a></li>
</ul>


        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#docker" class="page__taxonomy-item" rel="tag">docker</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#robotics" class="page__taxonomy-item" rel="tag">robotics</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#ros" class="page__taxonomy-item" rel="tag">ros</a>
    
    </span>
  </p>




      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/posts/introduction-to-deployable-robotics" class="btn btn--twitter" title="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/introduction-to-deployable-robotics" class="btn btn--facebook" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/posts/introduction-to-deployable-robotics" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="http://localhost:4000/posts/5-myths-about-dual-booting" class="pagination--pager" title="5 Myths about dual booting
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/notes-on-profiling-python-code" rel="permalink">Notes on Profiling Python code
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2021-07-21T00:00:00-07:00">July 21, 2021</time></p>
        

    <!--
    <p class="archive__item-excerpt" itemprop="description"><p>Profiling is the process of dynamic program analysis that measures the space/time complexity of the functions, frequency and duration of function calls, etc. It gives us the idea about where can we modify the code to have maximum impact on the performance of the program. In this blog post, I try to explain how to set up profiling tools for a python code and how can we find the code snippet which we can improve upon. We want to reduce the number of calls to that function.</p>

<p>There are numerous profling tools available for python out there. I use <code class="language-plaintext highlighter-rouge">yep</code>.</p>

<h2 id="setting-up-yep">Setting up yep</h2>
<p><code class="language-plaintext highlighter-rouge">yep</code> uses the <code class="language-plaintext highlighter-rouge">google-perftools</code> CPU profiler and depends on <code class="language-plaintext highlighter-rouge">pprof</code> for visualization. It profiles compiled code of C/C++/Fortran from the python interpreter.</p>

<ul>
  <li>Install <code class="language-plaintext highlighter-rouge">google-perftools</code> and <code class="language-plaintext highlighter-rouge">yep</code></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get install google-perftools
$ pip install yep
</code></pre></div></div>

<ul>
  <li>Mark the region to profile</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">yep</span>

<span class="n">yep</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="s">'perf.prof'</span><span class="p">)</span>
<span class="c1"># Code to profile
</span><span class="n">yep</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span></code></pre></figure>

<p>This will generate a <code class="language-plaintext highlighter-rouge">perf.prof</code> file which can be analysed using <code class="language-plaintext highlighter-rouge">pprof</code></p>

<h2 id="setting-up-pprof-and-profiling">Setting up pprof and profiling</h2>
<p><code class="language-plaintext highlighter-rouge">pprof</code> is a tool for visualization and analysis of profiling data. It can generate both text and graphical reports. It needs profiling sample in <a href="https://github.com/google/pprof/blob/master/proto/profile.proto">this</a> format which we’d generated using <code class="language-plaintext highlighter-rouge">yep</code>.</p>

<ul>
  <li>Install <code class="language-plaintext highlighter-rouge">pprof</code> and get report
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ go get -u github.com/google/pprof
$ pprof -cum -text -lines perf.prof
</code></pre></div>    </div>
  </li>
</ul>

<p>Now, let’s look at the report generated. It’ll have the fields - <code class="language-plaintext highlighter-rouge">flat</code>, <code class="language-plaintext highlighter-rouge">flat%</code>, <code class="language-plaintext highlighter-rouge">sum%</code>, <code class="language-plaintext highlighter-rouge">cum</code>, <code class="language-plaintext highlighter-rouge">cum%</code> and <code class="language-plaintext highlighter-rouge">context</code>. <code class="language-plaintext highlighter-rouge">flat</code> means the memory allocated and is held by the function. <code class="language-plaintext highlighter-rouge">cum</code> means the memory allocated by this function or the function that it called down the stack. <code class="language-plaintext highlighter-rouge">sum</code> means the memory spent by the previous lines. <code class="language-plaintext highlighter-rouge">context</code> means the line of code which has the corresponding call. A more detailed explanation can be found <a href="https://stackoverflow.com/a/56882137">here</a>.</p>

<p>Here, we used <code class="language-plaintext highlighter-rouge">-cum</code> flag to have the entries sorted by the <code class="language-plaintext highlighter-rouge">cum</code> value. The first entry will have the greatest <code class="language-plaintext highlighter-rouge">cum</code> value. This will be a function that is down the stack(a c++ stl operation for example). We need to look for the routine that calls this function. To do that, we’ll look the <code class="language-plaintext highlighter-rouge">context</code> which has our code and that has <code class="language-plaintext highlighter-rouge">sum%</code> just greater than the maximum <code class="language-plaintext highlighter-rouge">cum%</code> we’d just found. This is because, if we think of the function calls as taking up time, we know that whatever calls the function that is taking up the time should be slightly more time-consuming than the function call itself. So, we can figure out the caller of the function by looking for something with a cumulative call time higher than it. The difference between <code class="language-plaintext highlighter-rouge">sum%</code> and <code class="language-plaintext highlighter-rouge">cum%</code> is the key since cumulative includes it and all of its sub-calls.</p>

<p>I found it hard to digest this at first. Let’s talk through a real life example. Imagine you are spending time on your computer. There are various tasks you do at the computer - emails, coding, gaming, etc. The time you spend doing emails + coding + gaming is going to be slightly less than the time you spend at the computer, because of things like booting, navigating between menus, folders, etc. So if you are told, you spend Y amount of time doing X, you can see what contains X by looking one level up at the cumulative time total spent. If I told you, it looks like you spend 40min doing emails, what were you doing while doing emails, and you looked and saw, oh, I was at the computer for 41min, you could say, “That was part of my computer time”. Similarly, if we look at our routines, and the big time sink is taking X% of time, we want to look for the first routine that takes more than X%, because that’s likely to be the one that is calling it.</p>

<h2 id="references">References</h2>
<ul>
  <li>Most of the things I’d said to elaborate were exactly words of <a href="https://matthewturk.github.io/">Matt</a> while he was trying to make me understand. I didn’t want those to get buried, so I’d decided to write this up and publish</li>
  <li>https://gperftools.github.io/gperftools/cpuprofile.html</li>
  <li>https://github.com/google/pprof</li>
  <li>https://pypi.org/project/yep/</li>
  <li>https://www.freecodecamp.org/news/how-i-investigated-memory-leaks-in-go-using-pprof-on-a-large-codebase-4bec4325e192/</li>
  <li>https://v0dro.in/blog/2020/04/21/profiling-and-benchmarking-python-programs/</li>
  <li>https://stackoverflow.com/a/56882137</li>
</ul>
</p>
    -->
    
    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/indexing-ragged-arrays-in-python" rel="permalink">Indexing Ragged Arrays in Python
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2021-06-02T00:00:00-07:00">June 02, 2021</time></p>
        

    <!--
    <p class="archive__item-excerpt" itemprop="description"><p>This post is going to be a small attempt from my side to understand indexing ragged arrays and making that work with Python. Indexing a data structure is accessing its elements by making memory efficient. A ragged array or a jagged array is an array of arrays which the member arrays can be of different lengths. This is quite straightforward to implement when we think through Python.</p>

</p>
    -->
    
    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/gsoc-final" rel="permalink">GSoC final blog posts
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2019-08-25T00:00:00-07:00">August 25, 2019</time></p>
        

    <!--
    <p class="archive__item-excerpt" itemprop="description"><p>I was also writing on the PSF site about my progress in GSoC. So, I decided to migrate to that fully since it keeps an overview of the work that I’ve done. If you’re interested in reading about that, refer my <a href="https://blogs.python-gsoc.org/en/navaneethsureshs-blog/">blog</a> on the PSF site.</p>
</p>
    -->
    
    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/posts/gsoc-week-5-week-6" rel="permalink">GSoC Week 5 - Week 6
</a>
      
    </h2>
    
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
    

        
         <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2019-07-08T00:00:00-07:00">July 08, 2019</time></p>
        

    <!--
    <p class="archive__item-excerpt" itemprop="description"><p>I was working on adding interactive mode to <code class="language-plaintext highlighter-rouge">hg unshelve</code>. Until now, we cannot unshelve selected changes only from the stored shelve. We already have an interactive mode in <code class="language-plaintext highlighter-rouge">hg shelve</code>. I sent a patch<a href="https://phab.mercurial-scm.org/D6596">[1]</a> to add interactive mode to <code class="language-plaintext highlighter-rouge">unshelve</code></p>

</p>
    -->
    
    

  </article>
</div>

        
      </div>
    </div>
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        

<div class="page__footer-follow">

<div class="page__footer-copyright">&copy; 2021 Navaneeth Suresh. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <!-- start custom analytics snippet -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5Z002R3PSK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5Z002R3PSK');
</script>
<!-- end custom analytics snippet -->







  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'https-themousepotato-github-io';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>

